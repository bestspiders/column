# Copyright (c) 2017 VMware, Inc. All Rights Reserved.
# SPDX-License-Identifier: BSD-2-Clause

language: python
python:
  - "2.7_with_system_site_packages"

dist:
  - xenial

# command to install dependencies
install:
  - pip install tox-travis
  - pip install -r test-requirements.txt

# command to run tests
script: tox

after_success:
  - codecov -e $TRAVIS_PYTHON_VERSION

before_deploy:
  - sudo apt-get install python-setuptools python-all debhelper fakeroot
  - sudo pip install stdeb
  - export PYTHONPATH=/usr/local/lib/python2.7/dist-packages; python setup.py --command-packages=stdeb.command bdist_deb

deploy:
  - provider: pypi
    user: vmware_column
    password:
      secure: "MAHFyKpuUb5M9nYcqhc65SmCxC1GgFDKmYcNyoqeOqQBl3XG4/uvYxQkQ2h0RRZfMJiyNGE2fKKQSeXoavMrijDGitiiZ8IXkydP8hbNsanCL/kj0E/3MGXgIi08mOUUiKVuIn3zcDsqHUQgdRbwnMvHRVNrmeTifWwp9CrXQB0364I9CnW74O/yRJ6zewwrRKBN/xm1kWX4vyAmHvae59XcA70ViSnfqEYRKGrAZn10r7875HFRpfDHIbG8KawDKsZW0yAWkoRutSRoJ0HyyeTMptdJoEhx7Egze/sI7vy+a9i1SQ1M2FNQX1BXCPaNhO+som7QYzfY0FySGWzDVrkjCU4CDPM/1YSC42XLiG0QFilmy++OnhpAX+jMyWfxkjzw2ezou+5Y7X878Ga9pjYUA+8ceQemyhauWu0UlmYgli/cqldJ+Ac21Gtq2P/Pfor4RDE4GzTo1/rMgDow5Ly+UvE0dDlmeYed/n6jQH6uXWDSyJSVNVYcEKQw33A8kBX7KyjamU1rDtcvZGgGoajiXcb7KSjrX5IhxUNChadiriaQx4zRMNv5/4kFxXYTocR0xPguBe+Mo/50Fl72/Q4oVTXrdFsYBTX7R9QZebAYfSZRTMXvcn83M4M3IBknBpnIl4BF689lLnK30egzFTUOo6HTbNbVZrSAqdCSPys="
    distributions: sdist bdist_wheel
    skip_upload_docs: true
    skip_cleanup: true

  - provider: releases
    api_key:
      secure: "BVZs+G+JPVRCcWYX8ZKxNpd3IBV2MDARwkaZd/xdqVaX+VdoFwQY2G5Z2SzVNZ+CuWk5eafB+oZF27ZgUppeP3uO/JN7LRYQj4RYcdyZT6NDG20v0rF1V8oYjG5eZK/kd3pEGkTnsnXFIaPoBNTccAb4h7xGQ21PRut9oKyCtsSJHbNONkZlDpBDuCTGURILGPYRfSXOflCv6v6WdDVImcCB+UpcvJSLO7QyFTOUE/hdxyn3kFn5svWRLht0PJFTVxYzQi31yxpiWgPiH20iQifKF0pDWIhKL9SpqzN1bNgXGpq//LbB7Z1lhQg1JRgnfl0LMXeZLVjpyUKihpc9baDdajLSzAr0IN6jBYcrERl0i6dL6dspanjOMjrSfmetcu1jTrxO+AHRqivyNApft0GM1Wn0wfwin7VTB3zitdgrj2uI/nZB4P1fAeJ5HH9H/4H0kpwIQnQ3TJNpLUj7xGAFyYuxte5fVG8Il2GXrCnfSNotqFFKAuzHvpndA5+X4NElNG+hJGM0M28UT82It0eCqvF9cGzV23QkSt4SDBiHehxiXgujF2ndioQjhZdKXOycs0N1yoEm9/7vn6cRNi5Pk0IQUq1VM8IeZxJ+RptAuw6xlDq1z8VSHsZwVzpQP5icr7UbQD8Xvq/rGVrMSvkjpY5Xxd9cUZPPPtf3pAY="
    file_glob: true
    file:
      - dist/column*.whl
      - deb_dist/python-column*.deb
    skip_cleanup: true
    on:
      repo: vmware/column
